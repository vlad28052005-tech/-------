<!doctype html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Розклад — 4 курс, група В</title>
    <link rel="icon" href="favicon.ico">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="theme-color" content="#0ea5e9" />
    <style>
         :root {
            --bg: #0b1220;
            --panel: #0e1726;
            --text: #e5eefb;
            --muted: #a9b8d5;
            --accent: #0ea5e9;
            --card: #0f172a;
            --border: #1f2a44;
            --lec: #3b82f6;
            --prac: #facc15;
            --green: #16a34a;
        }
        
        [data-theme="light"] {
            --bg: #f8fafc;
            --panel: #fff;
            --text: #0b1220;
            --muted: #54627a;
            --card: #ffffff;
            --border: #e2e8f0;
        }
        
        * {
            box-sizing: border-box
        }
        
        html,
        body {
            height: 100%
        }
        
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font: 15px/1.4 system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
        }
        
        .wrap {
            max-width: 1150px;
            margin: 0 auto;
            padding: 12px
        }
        /* Topbar: responsive, doesn't overlap */
        
        .topbar {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            position: sticky;
            top: 0;
            background: linear-gradient(to bottom, var(--bg) 95%, transparent);
            padding: 10px 0;
            z-index: 30;
        }
        
        .brand {
            font-weight: 800
        }
        
        .top-left {
            min-width: 200px
        }
        
        .top-right {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
            min-width: 220px
        }
        
        .btn {
            border: 1px solid var(--border);
            background: var(--panel);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform .12s ease, box-shadow .12s ease;
        }
        
        .btn:active {
            transform: translateY(1px)
        }
        
        .btn.primary {
            background: linear-gradient(135deg, var(--accent), #22d3ee);
            color: #fff;
            border-color: transparent
        }
        
        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
            background: var(--panel);
            padding: 6px 10px;
            border-radius: 10px;
            border: 1px solid var(--border)
        }
        
        .muted {
            color: var(--muted);
            font-size: 13px
        }
        /* Grid */
        
        .grid {
            display: grid;
            gap: 10px
        }
        
        .cards {
            grid-template-columns: repeat(5, 1fr)
        }
        
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }
        
        .head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px
        }
        
        .day {
            font-weight: 700
        }
        
        .dateSmall {
            font-size: 13px;
            color: var(--muted)
        }
        /* Pair */
        
        .pair {
            border-radius: 10px;
            padding: 8px;
            margin: 6px 0;
            border: 1px solid rgba(255, 255, 255, 0.03);
            background: transparent;
            transition: opacity .18s, transform .12s;
        }
        
        .pair .meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 13px;
            align-items: center
        }
        
        .chip {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 999px
        }
        
        .lec {
            background: var(--lec);
            color: #fff
        }
        
        .prac {
            background: var(--prac);
            color: #000
        }
        
        .textpair {
            color: var(--muted);
            font-style: italic
        }
        
        h4 {
            margin: 2px 0;
            font-size: 14px
        }
        
        .past {
            opacity: .55
        }
        /* Highlights */
        
        .card.now {
            outline: 3px solid rgba(14, 165, 233, .85)
        }
        
        .pair.current {
            box-shadow: 0 8px 22px rgba(59, 130, 246, .08);
            border: 2px solid rgba(59, 130, 246, .95)
        }
        
        .pair.next {
            box-shadow: 0 8px 22px rgba(245, 158, 11, .08);
            border: 2px solid rgba(245, 158, 11, .95);
            position: relative
        }
        
        .pair.next .badge {
            position: absolute;
            right: 8px;
            top: 8px;
            background: rgba(255, 255, 255, 0.04);
            padding: 3px 6px;
            border-radius: 8px;
            font-size: 12px;
            color: var(--text)
        }
        
        .pair.upcoming {
            box-shadow: 0 8px 22px rgba(16, 163, 74, .06);
            border: 2px solid var(--green)
        }
        /* Responsive columns */
        
        @media (max-width:1100px) {
            .cards {
                grid-template-columns: repeat(2, 1fr)
            }
        }
        
        @media (max-width:680px) {
            .cards {
                grid-template-columns: 1fr
            }
            .top-right {
                justify-content: flex-end
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="topbar" role="banner">
            <div class="top-left">
                <div class="brand">Розклад — 4 курс, група В</div>
                <div class="muted">Двотижневий (Пн–Пт) • Офлайн</div>
            </div>

            <div class="top-right" role="navigation" aria-label="Панель навігації">
                <button id="toggleTheme" class="btn" title="Тема">Тема</button>
                <button id="todayBtn" class="btn">Сьогодні</button>

                <div class="controls" aria-hidden="false">
                    <button id="prevWeek" class="btn" aria-label="Попередній тиждень">◀</button>
                    <div style="min-width:90px;text-align:center"><strong id="weekLabel">Нижній</strong></div>
                    <button id="nextWeek" class="btn" aria-label="Наступний тиждень">▶</button>
                </div>
            </div>
        </div>

        <div class="grid cards" id="weekGrid" aria-live="polite"></div>
    </div>

    <script>
        // ---------- CONFIG ----------
        const STORAGE_KEY = 'schedule.vfinal';
        const DAYS = ['mon', 'tue', 'wed', 'thu', 'fri'];
        const DAY_NAMES = {
            mon: 'Пн',
            tue: 'Вт',
            wed: 'Ср',
            thu: 'Чт',
            fri: 'Пт'
        };

        // Default template — UPDATED: Thursday & Friday per your request (top/bottom).
        const defaultData = {
            settings: {
                theme: 'dark',
                baseTopWeekISO: '2025-09-01',
                perDay: 6
            },
            // times: indexed 0..6 (we may shift monday)
            times: [{
                    start: '08:00',
                    end: '09:20'
                }, // 1
                {
                    start: '09:30',
                    end: '10:50'
                }, // 2
                {
                    start: '11:00',
                    end: '12:20'
                }, // 3
                {
                    start: '12:40',
                    end: '14:00'
                }, // 4
                {
                    start: '14:10',
                    end: '15:30'
                }, // 5
                {
                    start: '15:40',
                    end: '17:00'
                }, // 6
                {
                    start: '17:10',
                    end: '18:30'
                } // 7 (if needed)
            ],
            template: {
                top: {
                    mon: [
                        null, {
                            type: 'lec',
                            title: 'Адміністративне судочинство',
                            teacher: 'Сушко О.О.',
                            place: 'Соборна, 48'
                        }, {
                            type: 'lec',
                            title: 'Господарське право',
                            teacher: 'Калаченкова К.О.',
                            place: '304'
                        }, {
                            type: 'lec',
                            title: 'Криміналістика',
                            teacher: 'Кавун С.М.',
                            place: '313'
                        }
                    ],
                    tue: [
                        null, null, null, null, {
                            type: 'lec',
                            title: 'СОП — Лідерство та командоутворення',
                            teacher: 'Середа Г.В.',
                            place: 'MS Teams'
                        }, {
                            type: 'prac',
                            title: 'СОП — Лідерство та командоутворення',
                            teacher: 'Середа Г.В.',
                            place: 'MS Teams'
                        }
                    ],
                    wed: [null, {
                        type: 'text',
                        title: 'Дисципліна з переліку'
                    }],
                    // <<-- THURSDAY (TOP) -->> 4,5,6 are lectures
                    thu: [
                        null, null, null, {
                            type: 'lec',
                            title: 'Корпоративне право',
                            teacher: 'Дорошенко Л.М.',
                            place: '304'
                        }, // 4
                        {
                            type: 'lec',
                            title: 'Земельне право',
                            teacher: 'Бахур О.В.',
                            place: '305'
                        }, // 5
                        {
                            type: 'lec',
                            title: 'Фінансове право',
                            teacher: 'Петренко Г.О.',
                            place: '305'
                        } // 6
                    ],
                    // FRIDAY (TOP): 2..5 as practices
                    fri: [
                        null, {
                            type: 'prac',
                            title: 'Адміністративне судочинство',
                            teacher: 'Сушко О.О.',
                            place: 'Соборна, 48'
                        }, // 2
                        {
                            type: 'prac',
                            title: 'Корпоративне право',
                            teacher: 'Дорошенко Л.М.',
                            place: '121'
                        }, // 3
                        {
                            type: 'prac',
                            title: 'Фінансове право',
                            teacher: 'Петренко Г.О.',
                            place: '305'
                        }, // 4
                        {
                            type: 'prac',
                            title: 'Криміналістика',
                            teacher: 'Кавун С.М.',
                            place: '313'
                        } // 5
                    ]
                },
                bottom: {
                    mon: [
                        null, {
                            type: 'lec',
                            title: 'Адміністративне судочинство',
                            teacher: 'Сушко О.О.',
                            place: 'Соборна, 48'
                        }, {
                            type: 'lec',
                            title: 'Господарське право',
                            teacher: 'Калаченкова К.О.',
                            place: '304'
                        }
                    ],
                    tue: [
                        null, null, null, null, {
                            type: 'lec',
                            title: 'СОП — Лідерство та командоутворення',
                            teacher: 'Середа Г.В.',
                            place: 'MS Teams'
                        }, {
                            type: 'prac',
                            title: 'СОП — Лідерство та командоутворення',
                            teacher: 'Середа Г.В.',
                            place: 'MS Teams'
                        }
                    ],
                    wed: [null, {
                        type: 'text',
                        title: 'Дисципліна з переліку'
                    }],
                    // <<-- THURSDAY (BOTTOM) -->> 4 lec,5 lec,6 practice
                    thu: [
                        null, null, null, {
                            type: 'lec',
                            title: 'Корпоративне право',
                            teacher: 'Дорошенко Л.М.',
                            place: '304'
                        }, // 4
                        {
                            type: 'lec',
                            title: 'Земельне право',
                            teacher: 'Бахур О.В.',
                            place: '305'
                        }, // 5
                        {
                            type: 'prac',
                            title: 'Земельне право',
                            teacher: 'Бахур О.В.',
                            place: '307'
                        } // 6 practice
                    ],
                    // FRIDAY (BOTTOM) 2..4 practices (4 — Господарське право практика)
                    fri: [
                        null, {
                            type: 'prac',
                            title: 'Адміністративне судочинство',
                            teacher: 'Сушко О.О.',
                            place: 'Соборна, 48'
                        }, //2
                        {
                            type: 'prac',
                            title: 'Корпоративне право',
                            teacher: 'Дорошенко Л.М.',
                            place: '121'
                        }, //3
                        {
                            type: 'prac',
                            title: 'Господарське право',
                            teacher: 'Калаченкова К.О.',
                            place: '121'
                        } //4
                    ]
                }
            },
            exceptions: {} // kept for future, not used unless you edit (no UI for editing now)
        };

        // ---------- storage ----------
        function load() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : structuredClone(defaultData);
            } catch (e) {
                return structuredClone(defaultData);
            }
        }

        function save(d) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
        }
        let data = load();

        // theme
        function applyTheme() {
            document.body.setAttribute('data-theme', data.settings.theme === 'light' ? 'light' : 'dark');
        }
        applyTheme();
        document.getElementById('toggleTheme').addEventListener('click', () => {
            data.settings.theme = data.settings.theme === 'light' ? 'dark' : 'light';
            save(data);
            applyTheme();
        });

        // date helpers
        function mondayOf(date) {
            const d = new Date(date);
            const day = (d.getDay() + 6) % 7; // shift: Mon=0
            d.setDate(d.getDate() - day);
            d.setHours(0, 0, 0, 0);
            return d;
        }

        function iso(d) {
            return d.toISOString().slice(0, 10);
        }

        function isTopWeek(date) {
            const base = mondayOf(new Date(data.settings.baseTopWeekISO));
            const cur = mondayOf(new Date(date));
            const diffWeeks = Math.round((cur - base) / (7 * 24 * 3600 * 1000));
            return diffWeeks % 2 === 0;
        }

        // times & monday-shift: if Monday and index>=1 -> use time index+1
        function getTimeFor(dayKey, pairIndex) {
            let timeIdx = pairIndex;
            if (dayKey === 'mon' && pairIndex >= 1) timeIdx = pairIndex + 1;
            return (data.times && data.times[timeIdx]) ? data.times[timeIdx] : {
                start: '',
                end: ''
            };
        }

        function getPairsForDay(dayKey, date) {
            const week = isTopWeek(date) ? 'top' : 'bottom';
            const tmpl = (data.template && data.template[week] && data.template[week][dayKey]) ? data.template[week][dayKey].slice() : [];
            const exc = data.exceptions[iso(date)];
            if (exc && exc[dayKey]) {
                exc[dayKey].forEach((p, idx) => {
                    tmpl[idx] = p;
                });
            }
            return tmpl;
        }

        // ---------- render ----------
        let currentMonday = mondayOf(new Date());
        const grid = document.getElementById('weekGrid');

        function formatDateShort(d) {
            return d.toLocaleDateString('uk-UA', {
                day: '2-digit',
                month: '2-digit'
            });
        }

        function render() {
            grid.innerHTML = '';
            const top = isTopWeek(currentMonday);
            document.getElementById('weekLabel').textContent = top ? 'Верхній' : 'Нижній';
            const today = new Date();
            const viewingCurrentWeek = mondayOf(today).getTime() === currentMonday.getTime();

            // compute highlight date (today or nearest future) only for current week
            let highlightDate = null;
            if (viewingCurrentWeek) {
                const todayKey = DAYS[(today.getDay() + 6) % 7];
                if (todayKey) {
                    const todayPairs = getPairsForDay(todayKey, today).filter(Boolean);
                    if (todayPairs.length > 0) highlightDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    else {
                        for (let off = 1; off < 7; off++) {
                            const d = new Date(today.getFullYear(), today.getMonth(), today.getDate() + off);
                            const key = DAYS[(d.getDay() + 6) % 7];
                            if (!key) continue;
                            const pairs = getPairsForDay(key, d).filter(Boolean);
                            if (pairs.length > 0) {
                                highlightDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
                                break;
                            }
                        }
                    }
                }
            }

            for (let i = 0; i < DAYS.length; i++) {
                const dKey = DAYS[i];
                const card = document.createElement('div');
                card.className = 'card';
                const dayDate = new Date(currentMonday.getTime() + i * 86400000);
                if (highlightDate && dayDate.getFullYear() === highlightDate.getFullYear() && dayDate.getMonth() === highlightDate.getMonth() && dayDate.getDate() === highlightDate.getDate()) {
                    card.classList.add('now');
                }

                const head = document.createElement('div');
                head.className = 'head';
                head.innerHTML = `<div><div class="day">${DAY_NAMES[dKey]}</div><div class="dateSmall">${formatDateShort(dayDate)}</div></div>`;
                card.appendChild(head);

                const pairs = getPairsForDay(dKey, dayDate);
                const visible = pairs.map((p, idx) => ({
                    p,
                    idx
                })).filter(x => x.p);

                if (visible.length === 0) {
                    const empty = document.createElement('div');
                    empty.className = 'muted';
                    empty.textContent = 'Вільний день 🎉';
                    card.appendChild(empty);
                    grid.appendChild(card);
                    continue;
                }

                // determine current/next/upcoming only if viewing current week and date matches
                const now = new Date();
                let currentIdx = -1,
                    nextIdx = -1;
                if (viewingCurrentWeek && iso(dayDate) === iso(now)) {
                    // find current
                    for (const v of visible) {
                        const realIdx = v.idx;
                        const t = getTimeFor(dKey, realIdx);
                        if (!t.start || !t.end) continue;
                        const st = parseTimeToDate(t.start, now);
                        const en = parseTimeToDate(t.end, now);
                        if (st && en && now >= st && now <= en) {
                            currentIdx = realIdx;
                            break;
                        }
                    }
                    if (currentIdx !== -1) {
                        // find next in same day after current
                        for (const v of visible) {
                            if (v.idx > currentIdx) {
                                nextIdx = v.idx;
                                break;
                            }
                        }
                    } else {
                        // nearest future today
                        for (const v of visible) {
                            const realIdx = v.idx;
                            const t = getTimeFor(dKey, realIdx);
                            if (!t.start) continue;
                            const st = parseTimeToDate(t.start, now);
                            if (st && st > now) {
                                nextIdx = realIdx;
                                break;
                            }
                        }
                    }
                }

                for (const v of visible) {
                    const p = v.p;
                    const realIdx = v.idx;
                    const t = getTimeFor(dKey, realIdx);
                    const box = document.createElement('div');
                    box.className = 'pair';
                    box.dataset.day = dKey;
                    box.dataset.index = realIdx;
                    // states
                    if (viewingCurrentWeek && iso(dayDate) === iso(now)) {
                        const st = t.start ? parseTimeToDate(t.start, now) : null;
                        const en = t.end ? parseTimeToDate(t.end, now) : null;
                        if (en && now > en) box.classList.add('past');
                        if (realIdx === currentIdx) box.classList.add('current');
                        if (realIdx === nextIdx && currentIdx !== -1) {
                            box.classList.add('next');
                        }
                        if (realIdx === nextIdx && currentIdx === -1) {
                            box.classList.add('upcoming');
                        } // nearest future
                    }

                    const chip = p.type === 'lec' ? `<span class="chip lec">Лекція</span>` : (p.type === 'prac' ? `<span class="chip prac">Практика</span>` : `<span class="chip textpair">Інфо</span>`);
                    box.innerHTML = `<div class="meta"><div>${t.start||''}–${t.end||''}</div>${chip}</div><h4>${escapeHtml(p.title)}</h4><div class="muted">${escapeHtml(p.teacher||'')}${p.place?(' • '+escapeHtml(p.place)) : ''}</div>`;
                    // add badge for next (when there is a current)
                    if (box.classList.contains('next') && box.querySelector('.badge') === null) {
                        const badge = document.createElement('div');
                        badge.className = 'badge';
                        badge.textContent = 'Наступна';
                        box.appendChild(badge);
                    }
                    card.appendChild(box);
                }

                grid.appendChild(card);
            }
        }

        // parse "HH:MM" into a Date on baseDate
        function parseTimeToDate(timeStr, baseDate) {
            if (!timeStr) return null;
            const [h, m] = timeStr.split(':').map(Number);
            if (!Number.isFinite(h)) return null;
            const d = new Date(baseDate);
            d.setHours(h, m || 0, 0, 0);
            return d;
        }

        function escapeHtml(s) {
            if (!s) return '';
            return String(s).replace(/[&<>"']/g, m => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            }[m]));
        }

        // navigation
        document.getElementById('prevWeek').addEventListener('click', () => {
            currentMonday.setDate(currentMonday.getDate() - 7);
            render();
        });
        document.getElementById('nextWeek').addEventListener('click', () => {
            currentMonday.setDate(currentMonday.getDate() + 7);
            render();
        });
        document.getElementById('todayBtn').addEventListener('click', () => {
            currentMonday = mondayOf(new Date());
            render();
        });

        // swipe left/right for mobile
        let touchStartX = 0,
            touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            const t = e.changedTouches[0];
            touchStartX = t.screenX;
            touchStartY = t.screenY;
        }, {
            passive: true
        });
        document.addEventListener('touchend', (e) => {
            const t = e.changedTouches[0];
            const dx = t.screenX - touchStartX;
            const dy = t.screenY - touchStartY;
            // ignore vertical swipes
            if (Math.abs(dy) > Math.abs(dx)) return;
            if (Math.abs(dx) > 60) {
                if (dx > 0) document.getElementById('prevWeek').click();
                else document.getElementById('nextWeek').click();
            }
        }, {
            passive: true
        });

        // initial render
        render();

        // register service worker (optional; won't break if not allowed)
        if ('serviceWorker' in navigator) {
            try {
                navigator.serviceWorker.register('./sw.js').catch(() => { /* ignore */ });
            } catch (e) {}
        }
    </script>
</body>

</html>